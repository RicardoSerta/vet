{% extends 'base_app.html' %}

{% block title %}Gest√£o - LumaVet{% endblock %}
{% block page_title %}Gest√£o{% endblock %}

{% block main_content %}
<div class="card">
    <div class="management-header">
        <div class="management-tabs">
            {% for cat in categories_nav %}
                <a href="{% url 'gestao_category' cat.slug %}"
                   class="management-tab {% if cat.slug == category %}active{% endif %}">
                    {{ cat.label }}
                </a>
            {% endfor %}
        </div>

        <div class="management-header-right">
            <form method="get" class="exams-search-form">
                <input type="text" name="q" placeholder="Buscar..."
                       value="{{ search_query|default_if_none:'' }}">
                <button type="submit">Buscar</button>
            </form>

            <a href="{% url 'gestao_create' category %}"
               class="btn-icon btn-icon-green management-add-btn"
               title="{% if category == 'clinicas' %}Nova{% else %}Novo{% endif %} {{ category_singular }}">
                +
            </a>
        </div>
    </div>

    <div class="table-wrapper">
        <table class="exams-table">
            <thead>
                {% with qparam=search_query|default_if_none:'' %}
                {% if category == 'pets' %}
                    <tr>
                        <th>
                            <a href="?order=nome&direction={% if order == 'nome' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                Nome
                                {% if order == 'nome' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?order=raca&direction={% if order == 'raca' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                Ra√ßa
                                {% if order == 'raca' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?order=tutor&direction={% if order == 'tutor' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                Tutor
                                {% if order == 'tutor' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?order=data&direction={% if order == 'data' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                Data de cadastro
                                {% if order == 'data' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th style="width: 110px; text-align:center;">A√ß√µes</th>
                    </tr>
                {% else %}
                    <tr>
                        <th>
                            <a href="?order=nome&direction={% if order == 'nome' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                Nome
                                {% if order == 'nome' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?order=email&direction={% if order == 'email' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                E-mail
                                {% if order == 'email' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?order=telefone&direction={% if order == 'telefone' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                Telefone
                                {% if order == 'telefone' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?order=data&direction={% if order == 'data' and direction == 'asc' %}desc{% else %}asc{% endif %}{% if qparam %}&q={{ qparam|urlencode }}{% endif %}">
                                Data de cadastro
                                {% if order == 'data' %}
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th style="width: 110px; text-align:center;">A√ß√µes</th>
                    </tr>
                {% endif %}
                {% endwith %}
            </thead>
            <tbody>
                {% if items %}
                    {% for item in items %}
                        {% if category == 'pets' %}
                            <tr>
                                <td>{{ item.name }}</td>
                                <td>{{ item.breed }}</td>
                                <td>{{ item.tutor.name }}</td>
                                <td>{{ item.created_at|date:"d/m/Y" }}</td>
                                <td style="text-align:center; white-space:nowrap;">
                                    <a href="{% url 'gestao_edit' category item.id %}" title="Editar"
                                       class="btn-icon btn-icon-blue"
                                       style="display:inline-flex; align-items:center; justify-content:center;">
                                        ‚úèÔ∏è
                                    </a>

                                    <form method="post" action="{% url 'gestao_delete' category item.id %}"
                                          style="display:inline;"
                                          onsubmit="return confirm('Tem certeza que deseja excluir {{ item.name|escapejs }}?');">
                                        {% csrf_token %}
                                        <button type="submit" title="Excluir" class="btn-icon btn-icon-red"
                                                style="border:0; cursor:pointer; margin-left:6px;">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td>{{ item.display_name }}</td>
                                <td>{{ item.email }}</td>
                                <td>{{ item.phone }}</td>
                                <td>{{ item.created_at|date:"d/m/Y" }}</td>
                                <td style="text-align:center; white-space:nowrap;">
                                    <a href="{% url 'gestao_edit' category item.id %}" title="Editar"
                                       class="btn-icon btn-icon-blue"
                                       style="display:inline-flex; align-items:center; justify-content:center;">
                                        ‚úèÔ∏è
                                    </a>

                                    <form method="post" action="{% url 'gestao_delete' category item.id %}"
                                          style="display:inline;"
                                          onsubmit="return confirm('Tem certeza que deseja excluir {{ item.name|escapejs }}?');">
                                        {% csrf_token %}
                                        <button type="submit" title="Excluir" class="btn-icon btn-icon-red"
                                                style="border:0; cursor:pointer; margin-left:6px;">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" style="text-align:center;">
                            {{ empty_message }}
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

